| [Prev](executable.ec_migrate_conf)  | 11.2. Executable Commands |  [Next](executable.ec_rt_stats2.php) |

<a name="executable.ec_rotate"></a>
## Name

ec_rotate — rotate Momentum ec_logger log files

## Synopsis

`/opt/msys/ecelerity/bin/ec_rotate` [ -c | -compress ]

`/opt/msys/ecelerity/bin/ec_rotate` [ -conf *`/path/to/config_file`* ]

`/opt/msys/ecelerity/bin/ec_rotate` [ -d | -default ]

`/opt/msys/ecelerity/bin/ec_rotate` [ -l | -logfile *`/path/to/logfile`* ]

`/opt/msys/ecelerity/bin/ec_rotate` [ -logdir *`/path/to/dir`* ]

`/opt/msys/ecelerity/bin/ec_rotate` [ -n | -nocompress ]

`/opt/msys/ecelerity/bin/ec_rotate` [ -r | -retention *`number`* ]

`/opt/msys/ecelerity/bin/ec_rotate` [ -s | -socket *`/path/to/socket`* ]

`/opt/msys/ecelerity/bin/ec_rotate` [ -v ]

<a name="idp13785088"></a>
## Description

**ec_rotate** will rotate and compress logs for you. The number of previous days logs to keep can be set. The **ec_rotate** command is typically run daily as a cron job from `/etc/cron.d/msys-ecelerity-core` (on Solaris look in `/var/spool/cron/crontabs/root`).

Momentum opens its logfiles at startup and maintains an open filehandle to them throughout its life cycle. When you invoke **ec_rotate**, the `mainlog.ec` file is moved to `mainlog.ec.1`, Momentum is instructed to re-open its logfiles and a new `mainlog.ec` file is created. Any other log files configured for rotation are treated in the same way. Unix file I/O semantics guarantee that no log lines will be lost between the time the file is moved and the logs are re-opened; they will simply appear in the older of the logs. To avoid the overhead of checking the logfile on every attempt, Momentum relies on the user to tell it when the logfile needs to be re-opened.

By default, **ec_rotate** controls log file rotation for the following files:

*   `/var/log/ecelerity/mainlog.ec`

*   `/var/log/ecelerity/paniclog.ec`

*   `/var/log/ecelerity/rejectlog.ec`

*   `/var/log/ecelerity/bouncelog.ec`

*   `/var/log/ecelerity/acctlog.ec`

*   `/var/log/ecelerity/smpplog.ec`

*   `/var/log/ecelerity/webui/accesslog.ec`

*   `/var/log/ecelerity/webui/errorlog.ec`

*   `/var/log/ecelerity/ecconfigd.log`

*   `/var/ecconfigd/apache/access.log`

*   `/var/ecconfigd/apache/error.log`

### Note

The **ec_rotate** script is hardcoded to rotate the files named above. You only need to create an `ec_rotate.conf` file if you wish to change the default location of these files, you wish to rotate additional files or you wish to change other options shown in [the section called “Example ec_rotate.conf file:”](executable.ec_rotate#executable.ec_rotate.ec_rotate.conf "Example ec_rotate.conf file:").

**ec_rotate** also compresses these files using bzip, and keeps seven days of logs on disk. You can modify this behavior using the following options:

<dl className="variablelist">

<dt>-c, -compress *`/path/to/utility`*</dt>

<dd>

Specify the full path to the compression utility to use for compressing logfiles. The default is `/usr/bin/bzip2` but `/usr/bin/gzip` can also be used.

</dd>

<dt>-conf *`/path/to/file`*</dt>

<dd>

Specify a configuration file for **ec_rotate** to use. The configuration file should be like the following:

```
enabled = yes
logfiles = /var/log/ecelerity/mainlog.ec \
           /var/log/ecelerity/paniclog.ec \
           /var/log/ecelerity/rejectlog.ec \
           /var/log/ecelerity/bouncelog.ec
```

`enabled` can be either `yes` or `no`. Log files to be rotated can be specified using the `logfiles` option. Log file names should be on one line and separated by space and the log file names should not contain spaces. If `enabled` equals `yes`, only log files specified at `logfiles` will be rotated. If `enabled` equals `no`, no logs will be rotated.

</dd>

<dt>-d, -default</dt>

<dd>

If this option is specified, the script will first try to find the configuration file at `/opt/msys/ecelerity/etc/ec_rotate.conf`. If this file exists, it will use it as the configuration file. This has the same effects as `-conf /opt/msys/ecelerity/etc/ec_rotate.conf`. Otherwise, files at their default locations will be rotated. For more information about the `ec_rotate.conf` file see [the section called “The `ec_rotate.conf` File”](executable.ec_rotate#ec_rotate.conf "The ec_rotate.conf File").

### Note

A sample `ec_rotate.conf` file is found in the `/opt/msys/ecelerity/etc/sample-configs` directory. However, you do not need to maintain an `ec_rotate.conf` file unless you wish to change the default values. If you do decide to use the the `ec_rotate.conf` file, be sure that you set `rt_stats_enabled` to `yes`.

</dd>

<dt>-l, -logfile *`/path/to/file`*</dt>

<dd>

Specify the logfile(s) to be rotated. May be specified multiple times to handle multiple logs. Logs generated by any of the Momentum's logging modules can be specified for rotation using this option.

</dd>

<dt>-logdir *`/path/to/dir`*</dt>

<dd>

Specify the log directories to be searched and rotate files with the suffix `.log`. Like the `logfile` option, this option may be specified multiple times to handle multiple directories.

</dd>

<dt>-n, -nocompress</dt>

<dd>

Do not compress files while rotating.

</dd>

<dt>-r, -retention *`number`*</dt>

<dd>

Specify the maximum number of logs to keep on disk. The default is `7`.

If you only want to keep files for three days, you would use:

```
shell> sudo /opt/msys/ecelerity/bin/ec_rotate \
  -l /var/log/ecelerity/mainlog.ec \
  -l /var/log/ecelerity/paniclog.ec \
  -l /var/log/ecelerity/rejectclog.ec \
  -l /var/log/ecelerity/bouncelog.ec \
  -l /var/log/ecelerity/acctlog.ec \
  -l /var/log/ecelerity/smpplog.ec \
  -l /var/log/ecelerity/webui/access_log \
  -l /var/log/ecelerity/webui/error_log \
  -l /var/log/ecelerity/ecconfigd.log \
  -l /var/ecconfigd/apache/access.log \
  -l /var/ecconfigd/apache/error.log
  -r 3
```
</dd>

<dt>-s, -socket *`/path/to/socket`*</dt>

<dd>

The path to the Control_Listener socket.

</dd>

</dl>

<a name="ec_rotate.conf"></a>
## The `ec_rotate.conf` File

The `ec_rotate.conf` file is the configuration file for the rotate and the RT stats scripts, namely **ec_rotate** and **ec_rt_stats2**. A sample `ec_rotate.conf` file is found in the `/opt/msys/ecelerity/etc/sample-configs/` directory. However, you do not need to maintain an `ec_rotate.conf` file unless you wish to change the default values. To use an `ec_rotate.conf` file, make the required changes to the sample file and then move it to the `/opt/msys/ecelerity/etc/` directory.

### Warning

If you do decide to use the the `ec_rotate.conf` file, be sure that you explicitly enable the services you want. For example, set `rt_stats_enabled` to `yes`.

Changing the values of options in `ec_rotate.conf` without consulting with support, is strongly discouraged.

<a name="idp13855904"></a>
## Comments and Whitespace

In common with many other Unix configuration files, the `ec_rotate.conf` file uses the `#` (commonly referred to as "hash", "pound" or "octothorpe") symbol to introduce a single line comment. Whitespace is unimportant in the various configuration stanza; feel free to pad the whitespace as you see fit for maximum readability.

<a name="idp13858672"></a>
## Options

The options `enabled` and `rt_stats_enabled` enable or disable their respective scripts. Refer to the following links for explanations of the options specific to them: [ec_rotate](executable.ec_rotate "ec_rotate") and [ec_rt_stats2](executable.ec_rt_stats2.php "ec_rt_stats2").

<a name="executable.ec_rotate.ec_rotate.conf"></a>
## Example ec_rotate.conf file:

```
# If enabled=yes, then ec_rotate will perform logfile rotation
# on the set of logfiles listed below.
# If you prefer to disable the default action without modifying
# the crontab entry installed by the package, you should do it here
# by setting enabled=no
#################################
# the options are as follows:
# enabled - yes/no - enables ec_rotate to be run
# logfiles - list of log files to rotate
# retention - the number of old log files to retain
# control_socket - the path to the ecelerity Control_Listener socket
# path_to_bzip - where to find the bzip2 binary on your system

enabled=yes

# The list of logfiles to rotate
logfiles =  /var/log/ecelerity/mainlog.ec \
            /var/log/ecelerity/paniclog.ec \
            /var/log/ecelerity/rejectlog.ec \
            /var/log/ecelerity/bouncelog.ec \
            /var/log/ecelerity/acctlog.ec \
            /var/log/ecelerity/smpplog.ec \
            /var/log/ecelerity/webui/access_log \
            /var/log/ecelerity/webui/error_log \
            /var/log/ecelerity/ecconfigd.log \
            /var/ecconfigd/apache/access.log \
            /var/ecconfigd/apache/error.log
logdirs = /var/log/ecelerity/adaptive

retention = 7

# ec_rt_stats2 specific information
##################################
# the options are as follows:
# enabled - yes/no - enables ec_rt_stats to be run
# mainlog - absolute path as shown in example below
# rejectlog - absolute path as shown in the example below
# bouncelog - absolute path as shown in the example below
# output_directory - absolute path to a directory - directory for output to be stored in
# verbose - yes/no - enable verbose mode
# user - string - ec_rt_stats2 runs as this user
# alternate_pid - path to alternate pid file
# time_window_size - integer, seconds, if you change it, you will break things

# rt_stats_enabled = yes
# rt_stats_mainlog = /var/log/ecelerity/mainlog.rt
# rt_stats_rejectlog = /var/log/ecelerity/rejectlog.rt
# rt_stats_bouncelog = /var/log/ecelerity/bouncelog.rt
# rt_stats_statplog = /var/log/ecelerity/statp.rt
# rt_stats_c14_patterns = /opt/msys/ecelerity/etc/c14n_patterns
# rt_stats_verbose = no
# rt_stats_user = ecuser
# rt_stats_alternate_pid = /var/run/ec_rt_stats
# rt_stats_time_window_size = 60 # do not change!
# rt_stats_subscriber = ec_rt_stats # MUST match your ecelerity.conf
# rt_stats_cache_db = dbi:SQLite:dbname=/var/log/ecelerity/pg_cache.db

# Whether to only log domains present in the watchlist
# rt_stats_watchlist_only = no

# target database and credentials
# rt_stats_driver = dbi:Pg:dbname=ecelerity;connect_timeout=300
# rt_stats_driver_user = ecuser
# rt_stats_driver_pass =

# adaptive_loader configuration
###############################
# adaptive_loader_log = /var/log/ecelerity/adaptive.rt
# adaptive_loader_verbose = no
# adaptive_loader_user = ecuser
# adaptive_loader_alternate_pid = /var/run/adaptive_loader
# adaptive_loader_cache_db = /var/log/ecelerity/pg_cache.db
## retention times are in seconds. 0 means forever.
# adaptive_loader_retention = 604800

# target database and credentials
# adaptive_loader_driver = dbi:Pg:dbname=ecelerity;connect_timeout=300
# adaptive_loader_driver_user = ecuser
# adaptive_loader_driver_pass =

# webui rollup configuration
#############################
# rollup_passes = 10
# rollup_driver = dbi:Pg:dbname=ecelerity;connect_timeout=300
# rollup_driver_user = ecuser
# rollup_driver_pass =
# rollup_pidfile = /var/log/ecelerity/rollup.pid
## retention times are in seconds. 0 means forever.
# rollup_1min_retention = 21600
# rollup_15min_retention = 86400
# rollup_1hr_retention = 604800
## the 6hr data are kept for 30 days, they can be extended if needed.
# rollup_6hr_retention = 2592000
## the 1day data are kept forever, they can be shortened if needed.
# rollup_1day_retention = 30

# vim:ts=2:sw=2:et:ft=conf:
```

The blank options in the above file are equivalent to not passing the option in to the script.

The `ec_rotate.conf` file options are listed below sorted by the elements the options affect.

ec_rotate:

*   `enabled` – yes

    Whether log file rotation is enabled.

*   `logfiles`

    The list of log files to rotate. See also [ec_rotate](executable.ec_rotate "ec_rotate").

*   `retention`

    The retention period in days.

rt_stats2:

*   rt_stats_enabled – yes

    *If you do decide to use the the `ec_rotate.conf` file, be sure that you set this option to `yes`.*                                                                                                See also [ec_rt_stats2](executable.ec_rt_stats2 "ec_rt_stats2"). As of version 3.0.15, if this option is not present in the configuration file, it will default to `yes`. In previous versions the default was `no`.

*   `rt_stats_mainlog` – `/var/log/ecelerity/mainlog.rt`

    The location of main log.

*   `rt_stats_bouncelog` – `/var/log/ecelerity/bouncelog.rt`

    The location of bounce log.

*   `rt_stats_rejectlog` – `/var/log/ecelerity/rejectlog.rt`

    The location of reject log.

*   `rt_stats_statplog` – `/var/log/ecelerity/statp.rt`

    The location of stats log.

*   `rt_stats_verbose` – no

    Toggle verbose output.

*   `rt_stats_c14_patterns` – `/opt/msys/ecelerity/etc/c14n_patterns`

    The location of the user-definable ec_rt_stats2 canonicalizers. See the `/opt/msys/ecelerity/etc/c14n_patterns` file for examples. These patterns are automatically added to the normalize function used in ec_rt_stats2.

*   `rt_stats_user` – ecuser

    The user rt_stats2 runs as.

*   `rt_stats_alternate_pid` – `/var/run/ec_rt_stats`

    The location of the PID file.

*   `rt_stats_time_window_size` – 60

    The window size.

*   `rt_stats_subscriber` – ec_rt_stats

    The name of the rt_stats subscriber.

*   `rt_stats_cache_db` – dbi:SQLite:dbname=/var/log/ecelerity/pg_cache.db

    The location of the cache file.

*   `rt_stats_driver` – dbi:Pg:dbname=ecelerity

    The database driver. On cluster nodes the host must be specified, for example: dbi:Pg:host=*`mgr.example.com;`*dbname=ecelerity. In a stand-alone configuration, the host is not required.

*   `rt_stats_driver_user` – ecuser

    This option specifies the PostgreSQL database user name.

*   `rt_stats_driver_pass` – ""

    This option specifies the PostgreSQL database user password.

*   `rt_stats_watchlist_only` – no

    **Configuration Change. ** This feature is available starting from Momentum 3.0.13.

    The default behavior is to log bounces for all domains. Use this option to log only for the domains defined in the watchlist data source. For more information see [Section 14.71, “statp – Stats Producer Module”](modules.stats_producer "14.71. statp – Stats Producer Module").

adaptive_loader configuration

The adaptive_loader configuration options perform the same functions as the similarly named ec_rt_stats options. For more information about these options see [adaptive_loader](executable.adaptive_loader "adaptive_loader").

webui:

*   rollup_passes = 10

*   rollup_driver = dbi:Pg:dbname=ecelerity;connect_timeout=300

    The database driver. On cluster nodes the host must be specified, for example: dbi:Pg:host=*`mgr.example.com;`*dbname=ecelerity. In a stand-alone configuration, the host is not required.

*   rollup_driver_user = ecuser

    The PostgeSQL database user name.

*   rollup_driver_pass =

    This option specifies the PostgreSQL database user password.

*   rollup_pidfile = /var/log/ecelerity/rollup.pid

    The rollup process id.

*   rollup_1min_retention = 21600

    Expressed in seconds, the default retention is six hours.

*   rollup_15min_retention = 86400

    Expressed in seconds, the default retention is one day.

*   rollup_1hr_retention = 604800

    Expressed in seconds, the default retention is seven days.

*   rollup_6hr_retention = 63072000

    Expressed in seconds, the default retention is 730 days.

*   rollup_1day_retention = 30

    As of version 3.0.28, the default setting for the one day retention changed to `2592000` (30 days).

    `0` indicates that data is never purged.

Reducing the retention values reduces database consumption but also means that you have less fine-grained data. In some cases, changing rollup retention values may break graphing.

| [Prev](executable.ec_migrate_conf)  | [Up](exe.commands.details.php) |  [Next](executable.ec_rt_stats2.php) |
| ec_migrate_conf  | [Table of Contents](index) |  ec_rt_stats2 |
